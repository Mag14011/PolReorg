# Compute Polarized Reorganization Energy

A Python package for calculating electron transfer reorganization energies with explicit consideration of electronic polarization effects, using molecular polarizability tensors from quantum mechanical calculations combined with electric fields from molecular dynamics trajectories or synthetic sources.

## Overview

This package computes reorganization energies for electron transfer processes by combining:
- Molecular polarizability tensors from QM calculations
- Electric fields from either:
  - MD trajectory analysis
  - Synthetic field generation based on user-specified parameters

The package supports both single-point calculations and iterative analysis of field-dependent reorganization energies.

## Key Features

- **Flexible Field Sources**:
  - MD-derived fields with optional filtering
  - Synthetic fields with customizable distributions (fixed, Gaussian, uniform)
  - Support for both MD-derived and heme-based coordinate systems

- **Comprehensive Analysis**:
  - Coordinate transformations between MD and QM reference frames
  - Tensor-field interactions and polarization energy calculations 
  - Statistical analysis of energetic components
  - Frame-by-frame energy decomposition

- **Visualization & Output**:
  - Energy decomposition plots
  - Field magnitude distribution analysis
  - Optional tensor/field visualization animations
  - Detailed output files with calculation metadata

## Installation

1. Clone the repository:
```bash
git clone [repository-url]
cd compute-polarized-reorg-energy
```

2. Install required dependencies:
```bash
pip install numpy pandas matplotlib plotly
```

## Usage

### Basic Usage

```python
from compute_polarized_reorg_energy import run_analysis

# Single point calculation with MD fields
result = run_analysis(
    reactant_donor_id="123",
    reactant_acceptor_id="456",
    basis_set_scaling=1.0,
    use_synthetic_fields=False
)

# Using synthetic fields
result = run_analysis(
    reactant_donor_id="123",
    reactant_acceptor_id="456",
    basis_set_scaling=1.0,
    use_synthetic_fields=True,
    synthetic_field_params={
        'approach': 'direction_from_md',
        'reactant_donor': {
            'distribution': 'fixed',
            'magnitude': 0.5
        },
        # ... additional parameters for other positions
    }
)
```

### Command Line Interface

The package provides a comprehensive CLI for both interactive and script-based usage:

```bash
python ComputePolarizedReorgEng.py --reactant_donor_id 123 --reactant_acceptor_id 456 --basis_set_scaling 1.0
```

See `python ComputePolarizedReorgEng.py --help` for full command line options.

## Input Files

The package requires a `FilePaths.txt` configuration file in the working directory. This file should specify paths to all required input files using the following format:

```
# Reference coordinates and polarizability tensors
red_ref_coords           = /path/to/reduced_state.xyz
ox_ref_coords           = /path/to/oxidized_state.xyz
red_ref_tensor          = /path/to/reduced_state.ten
ox_ref_tensor           = /path/to/oxidized_state.ten

# Simulation XYZ files
reactant_donor_xyz      = /path/to/reactant_donor.xyz
reactant_acceptor_xyz   = /path/to/reactant_acceptor.xyz
product_donor_xyz       = /path/to/product_donor.xyz
product_acceptor_xyz    = /path/to/product_acceptor.xyz

# Coulombic State Energies
reactant_coulombic      = /path/to/reactant_energies.dat
product_coulombic       = /path/to/product_energies.dat

# Electric Fields
reactant_donor_efield    = /path/to/reactant_donor_field.dat
reactant_acceptor_efield = /path/to/reactant_acceptor_field.dat
product_donor_efield     = /path/to/product_donor_field.dat
product_acceptor_efield  = /path/to/product_acceptor_field.dat
```

### Input File Formats

#### Polarizability Tensor Files (.ten)
Generated from Gaussian calculations using the Polar keyword and processed with MultiWFN. Format:
```
[filename] | xx xy xz yy yz zz | (xx+xy+xz) (yy+yx+yz) (zz+zx+zy) | iso aniso1 aniso2 aniso3
```
Example:
```
ActiveSiteFe2PIm2_polar.log | 119.97   0.25   0.15 115.13   4.62  78.91 | 120.37 120.00  83.68 | 104.67  39.69  38.87  22.98
```
Fields:
- Polarizability tensor components (xx, xy, xz, yy, yz, zz)
- Sum of components for each direction
- Isotropic and anisotropic components

#### Electric Field Files (.dat)
Generated by EFieldAnalysis, containing electric field magnitudes and components for each frame of the trajectory.

#### Coulombic Energy Files (.dat)
Generated using the included CPPTRAJ script, containing frame-by-frame Coulombic interaction energies.

#### Trajectory Files (.xyz)
Standard XYZ format molecular coordinate files containing:
- Number of atoms (first line)
- Comment line (second line)
- Atom coordinates (subsequent lines)

## Output Files

The package generates several types of output:

- Text files (.txt):
  - State-specific analysis results
  - Reorganization energy calculations
  - Field statistics and energy decomposition
  
- Plots (.png):
  - Energy decomposition visualizations
  - Field distribution analysis
  - Coordinate transformation RMSD plots
  
- Animations (.mp4):
  - Optional tensor/field visualizations
  - Energy decomposition animations

## Analysis Modes

### MD-derived Fields

- Optional filtering methods:
  - Threshold-based
  - Variance-based
  - Exact magnitude matching

### Synthetic Fields

Two approaches available:

1. **Direction from MD**:
   - Uses MD trajectory directions
   - Applies user-specified magnitudes
   
2. **Heme-based**:
   - Defines field directions using heme coordinates
   - Supports fixed axes and customizable orientations

Both approaches support:
- Fixed magnitudes
- Gaussian distributions
- Uniform distributions

### Iterative Analysis

Supports systematic variation of:
- Field magnitudes
- Filter parameters
- Single or multiple position iteration

## Example Results

The package computes:
- Unpolarized reorganization energy
- Polarized reorganization energy
- Detailed energy decomposition
- Statistical analysis of field effects

## Contributing

Contributions are welcome! Please feel free to submit pull requests.

## License

[License information]

## Citation

If you use this package in your research, please cite:
[Citation information]

## Authors

- Matthew J. Guberman-Pfeffer

## Acknowledgments

[Acknowledgments information]
